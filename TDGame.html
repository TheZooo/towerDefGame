<html>

<head>
    <script src="p5/p5.min.js"></script>
    <script src="p5/p5.collide2D.min.js"></script>
    <script>
        //OTHER VARIABLES
        var d = document;
        var gridX = [];
        var gridY = [];
        var gridSize = 27;
        var cellCountX = 20;
        var cellCountY = 20;
        var w = (gridSize * cellCountX) + 1;
        var h = (gridSize * cellCountY) + 1;
        var showGrid = true;
        var oneTime = 0;
        var mouseClick = false;
        var oneClickRegulator = true;
        var difficulties = ["Impossible", "Difficult", "Hard", "Medium", "Easy", "Very Easy", "Baby Mode"];
        var diffSetter = 0;
        //GAME PHASES
        var gamePhase = -3;
        var baseGamePhase = -4;
        //CURSOR X AND Y
        var cursorX = 0;
        var cursorY = 0;
        //START POINT
        var startX = 0;
        var startY = 0;
        var isStartPlaced = false;
        //END POINT
        var endX = 0;
        var endY = 0;
        var isEndPlaced = false;
        //PATH FROM START TO END
        var oneKeyRegulator = true;
        var pathX = [];
        var pathY = [];
        var pathAmt = 0;
        var isPathConnected = false;
        //MOBS GOING FROM START TO END
        var mobX = [];
        var mobY = [];
        var mobType = [];
        var mobAmt = 0;
        //OBJECTS
        var mobStart = new mobStart();
        var mobEnd = new mobEnd();
        var pathways = new pathways();
        var mobCreep = new mobCreep();
        //Main setup function for p5
        function setup() {
            createCanvas(w, h);
            for (oneTime; oneTime < h - 1; oneTime += gridSize) { //setup position of grid
                gridY.push(oneTime);
                for (var ii = 0; ii < w; ii += gridSize) {
                    gridX.push(ii);
                }
            }
        }
        //Main draw function for p5
        function draw() {
            background(220);
            for (var y = 0; y < cellCountY; y++) { //show grid
                if (mouseY > gridY[y] && mouseY < gridY[y] + gridSize + 2) {
                    cursorY = y;
                }
                for (var x = 0; x < cellCountX; x++) {
                    if (mouseX >= gridX[x] && mouseX <= gridX[x + 1]) {
                        cursorX = x;
                    }
                    if (showGrid === true) {
                        stroke(190);
                        strokeWeight(1);
                    } else {
                        noStroke();
                    }
                    noFill();
                    if (gridX[x] === gridX[cursorX] && gridY[y] === gridY[cursorY]) {
                        fill(55, 110, 55, 50);
                    }
                    rect(gridX[x], gridY[y], gridSize, gridSize);
                }
            }
            //----------------------------------------------------------------------------
            if (gamePhase === -4) {
                d.getElementById('infoPanel').innerHTML =
                    "-This is where information for things will be placed. This tower defence game only has a map creator for your enjoyment. (Hit Play)";
            }
            if (gamePhase === -3) {
                d.getElementById('infoPanel').innerHTML = "-Place where you want the mobs to come from. (" +
                    "Left Click" + ")";
            }
            if (gamePhase === -2) {
                d.getElementById('infoPanel').innerHTML = "-Place where you want your base to be. (" + "Left Click" +
                    ")";
            }
            if (gamePhase === -1) {
                d.getElementById('infoPanel').innerHTML =
                    "-Use WASD to direct the path from the start to the end. -Path: " + pathAmt +
                    " -Difficulty: " + difficulties[diffSetter];
                if (pathAmt <= 3) {
                    diffSetter = 0;
                } else if (pathAmt > 3 && pathAmt <= 10) {
                    diffSetter = 1;
                } else if (pathAmt > 10 && pathAmt <= 15) {
                    diffSetter = 2;
                } else if (pathAmt > 15 && pathAmt <= 20) {
                    diffSetter = 3;
                } else if (pathAmt > 20 && pathAmt <= 25) {
                    diffSetter = 4;
                } else if (pathAmt > 25 && pathAmt <= 30) {
                    diffSetter = 5;
                } else if (pathAmt > 30) {
                    diffSetter = 6;
                }
            }
            if (gamePhase === 0) {
                d.getElementById('infoPanel').innerHTML = "- Select things to see more info";
            }
            //----------------------------------------------------------------------------
            if (mouseX < w && mouseX > 0 && mouseY < h && mouseY > 0) {
                if (mouseClick === true && oneClickRegulator === true) {
                    if (gamePhase === -3) {
                        mobStart.place();
                    } else if (gamePhase === -2) {
                        mobEnd.place();
                    }
                    oneClickRegulator = false;
                }
            }
            if (isPathConnected === false && gamePhase === -1) {
                pathways.place();
            }
            if (isPathConnected === true || gamePhase === -1) {
                pathways.show();
            }
            if (isStartPlaced === true || gamePhase === -3) {
                mobStart.show();
            }
            if (isEndPlaced === true || gamePhase === -2) {
                mobEnd.show();
            }

        }
        //Whatever I want to put here (Hotkeys maybe)
        function keyPressed() {
            if (keyCode === 79) { //Enabling and Disabling Grid with o
                if (showGrid === true) {
                    showGrid = false;
                } else if (showGrid === false) {
                    showGrid = true;
                }
            }
        }
        //REGISTERING CLICK
        function mousePressed() {
            mouseClick = true;
        }

        function mouseReleased() {
            mouseClick = false;
            oneClickRegulator = true;
        }
        //REGISTERING KEY PRESS
        function keyReleased() {
            oneKeyRegulator = true;
        }
        //The point where mobs will spawn
        function mobStart() {
            this.size = gridSize / 2;
            this.centerer = this.size;
            this.place = function () {
                if (gamePhase === -3 && isStartPlaced === false) {
                    isStartPlaced = true;
                    gamePhase++;
                    startX = cursorX;
                    startY = cursorY;
                    pathX.push(startX);
                    pathY.push(startY);
                    pathAmt++;
                }
            };
            this.show = function () {
                if (isStartPlaced === true) {
                    this.x = gridX[startX] + this.centerer;
                    this.y = gridY[startY] + this.centerer;
                } else {
                    this.x = gridX[cursorX] + this.centerer;
                    this.y = gridY[cursorY] + this.centerer;
                }
                stroke(0);
                strokeWeight(1);
                fill(125, 50, 80);
                ellipse(this.x, this.y, this.size);
            };
        }
        //The point where mobs will stop at
        function mobEnd() {
            this.size = gridSize / 2;
            this.centerer = this.size;
            this.place = function () {
                if (gamePhase === -2 && isEndPlaced === false) {
                    isEndPlaced = true;
                    gamePhase++;
                    endX = cursorX;
                    endY = cursorY;
                }
            };
            this.show = function () {
                if (isEndPlaced === true) {
                    this.x = gridX[endX] + this.centerer;
                    this.y = gridY[endY] + this.centerer;
                } else {
                    this.x = gridX[cursorX] + this.centerer;
                    this.y = gridY[cursorY] + this.centerer;
                }
                stroke(0);
                strokeWeight(1);
                fill(50, 210, 50);
                ellipse(this.x, this.y, this.size);
            };
        }
        //Determines the direction of mobs
        function pathways() {
            this.size = gridSize;
            this.place = function () {
                if (gamePhase === -1 && isPathConnected === false) {
                    if (oneKeyRegulator === true) {
                        if (keyIsDown(65) && pathX[pathAmt - 1] > 0) { //Left
                            pathX.push(pathX[pathAmt - 1] - 1);
                            pathY.push(pathY[pathAmt - 1]);
                            pathAmt++;
                            oneKeyRegulator = false;
                        }
                        if (keyIsDown(68) && pathX[pathAmt - 1] < cellCountX - 1) { //Right
                            pathX.push(pathX[pathAmt - 1] + 1);
                            pathY.push(pathY[pathAmt - 1]);
                            pathAmt++;
                            oneKeyRegulator = false;
                        }
                        if (keyIsDown(87) && pathY[pathAmt - 1] > 0) { //Up
                            pathX.push(pathX[pathAmt - 1]);
                            pathY.push(pathY[pathAmt - 1] - 1);
                            pathAmt++;
                            oneKeyRegulator = false;
                        }
                        if (keyIsDown(83) && pathY[pathAmt - 1] < cellCountY - 1) { //Down
                            pathX.push(pathX[pathAmt - 1]);
                            pathY.push(pathY[pathAmt - 1] + 1);
                            pathAmt++;
                            oneKeyRegulator = false;
                        }
                    }
                    if (pathX[pathAmt - 1] === endX && pathY[pathAmt - 1] === endY) {
                        isPathConnected = true;
                        gamePhase++;
                    }
                }
            };
            this.show = function () {
                for (var i = 0; i < pathAmt; i++) {
                    var x = pathX[i];
                    var y = pathY[i];
                    this.x = gridX[x];
                    this.y = gridY[y];
                    strokeWeight(0);
                    fill(80, 80, 80, 50);
                    rect(this.x, this.y, this.size, this.size);
                }
            };
        }
        //This is where mobs go
        function mobCreep() {

        }
    </script>
    <style>
        canvas {
            position: absolute;
            top: 10px;
            left: 200px;
        }

        #infoPanelTitle {
            width: 183px;
            height: 50px;
            background-color: rgba(80, 80, 80, 0.5);
            border: 2px solid rgb(0, 0, 0);
            line-height: 60px;
            font-size: 40px;
            text-indent: 5px;
            user-select: none;
            position: absolute;
            top: 10px;
        }

        #infoPanel {
            width: 163px;
            background-color: rgba(80, 80, 80, 0.5);
            border: 2px solid rgb(0, 0, 0);
            overflow-wrap: break-word;
            padding: 10px;
            text-indent: 5px;
            font-size: 20px;
            user-select: none;
            position: absolute;
            top: 67px;
        }
    </style>
</head>

<body>
    <div id="infoPanelTitle">Info Panel</div>
    <div id="infoPanel"></div>
</body>

</html>
