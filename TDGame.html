<html>

<head>
    <script src="p5.min.js"></script>
    <script src="p5.collide2D.min.js"></script>
    <script>
        var gridX = [];
        var gridY = [];
        var gridSize = 15;
        var cellCountX = 30;
        var cellCountY = 30;
        var w = (gridSize * cellCountX) + 1;
        var h = (gridSize * cellCountY) + 1;
        var showGrid = true;
        var oneTime = 0;
        var gamePhase = -2;
        var baseGamePhase = -3;

        var cursorX = 0;
        var cursorY = 0;

        var startX = 0;
        var startY = 0;
        var isStartPlaced = false;

        var mobStart = new mobStart();

        function setup() {
            createCanvas(w, h);
        }

        function draw() {
            background(220);
            for (oneTime; oneTime < h - 1; oneTime += gridSize) { //setup position of grid
                gridY.push(oneTime);
                for (var ii = 0; ii < w; ii += gridSize) {
                    gridX.push(ii);
                }
            }
            for (var y = 0; y < cellCountY; y++) { //show grid
                if (mouseY > gridY[y] && mouseY < gridY[y] + gridSize + 2) {
                    cursorY = y;
                }
                for (var x = 0; x < cellCountX; x++) {
                    if (mouseX >= gridX[x] && mouseX <= gridX[x + 1]) {
                        cursorX = x;
                    }
                    if (showGrid === true) {
                        stroke(190);
                        strokeWeight(1);
                    } else {
                        noStroke();
                    }
                    noFill();
                    if (gridX[x] === gridX[cursorX] && gridY[y] === gridY[cursorY]) {
                        fill(55, 110, 55, 50);
                    }
                    rect(gridX[x], gridY[y], gridSize, gridSize);
                }
            }
            //----------------------------------------------------------------------------
            if (mouseButton === LEFT && gamePhase === -2) {
                mobStart.place();
            }
            mobStart.show();
            document.getElementById('dump').innerHTML = mouseY + " " + cursorY;
        }

        function keyPressed() {
            if (keyCode === 79) {
                if (showGrid === true) {
                    showGrid = false;
                } else if (showGrid === false) {
                    showGrid = true;
                }
            }
        }

        function mobStart() {
            this.size = 10;
            this.centerer = gridSize/4;
            this.place = function() {
                if (gamePhase === -2 && isStartPlaced === false) {
                    isStartPlaced = true;
                    gamePhase++;
                    startX = cursorX;
                    startY = cursorY;
                }
            };
            this.show = function() {
                if (isStartPlaced === true) {
                    this.x = gridX[startX] + this.centerer;
                    this.y = gridY[startY] + this.centerer;
                } else {
                    this.x = gridX[cursorX] + this.centerer;
                    this.y = gridY[cursorY] + this.centerer;
                }
                stroke(0);
                strokeWeight(1);
                fill(125, 50, 80);
                rect(this.x, this.y, 10, 10);
            };
        }
    </script>
    <style>
        canvas {
            position: absolute;
            top: 10px;
            left: 10vw;
        }
    </style>
</head>

<body>
    <p id="dump"></p>
</body>

</html>
